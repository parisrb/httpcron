(function(){var a={},b={},c=XMLHttpRequest;DigestAuthentication={persistent:!0,sessionStorageKey:"DigestAuthenticationSession",registerInterface:function(){XMLHttpRequest=DigestAuthentication.XMLHttpRequest},registerCredentials:function(b,c,d){d=d||"*";var e=a[d]||{};e.username=b,e.password=c,a[d]=e},registerUsername:function(b,c){c=c||"*";var d=a[c]||{};d.username=b,a[c]=d},registerPassword:function(b,c){c=c||"*";var d=a[c]||{};d.password=b,a[c]=d},registerHA1:function(b,c){c=c||"*";var d=a[c]||{};d.ha1=b,a[c]=d,this.saveSessionInfo()},reset:function(b){b=b||"*",delete a[b],this.saveSessionInfo(),_digestChalanges={}},saveSessionInfo:function(){this.persistent&&localStorage.setItem(this.sessionStorageKey,JSON.stringify(a))},loadSessionInfo:function(){if(this.persistent){var b=localStorage.getItem(this.sessionStorageKey);if(b)try{a=JSON.parse(b)||{}}catch(c){a={}}}}};var d=function(b){b=b||"*";return a[b]?a[b]:!1};DigestAuthentication.loadSessionInfo(),DigestAuthentication.Header=function(){var a,b,c,d,e,f;this.setCredantials=function(c,d){a=c,b=d},this.setHA1=function(a){c=a},this.getHA1=function(){return c||h()},this.getRealm=function(){return d.realm},this.getUsername=function(){return a},this.parse=function(a){var b,c,e,f,g,h,i;d={},h=a.replace(/^Digest\s?/,"").split(/\s?,\s?/);for(f=0,g=h.length;f<g;f++)b=h[f],b.match(/^nonce=/)?d.nonce=b.replace(/^nonce=\s?/,"").replace(/"/g,""):(i=b.split(/\s?=\s?/),c=i[0],e=i[1],d[c]=e.replace(/"/g,""))},this.generate=function(b,c){var g,h,j;if(!d)throw new Error("No Digest Chalange");g={uri:b,response:i(b,c),username:a,cnonce:e,realm:d.realm,nonce:d.nonce,opaque:d.opaque,algorithm:d.algorithm},h=[];for(j in g)h.push(""+j+'="'+g[j]+'"');h.push("qop="+d.qop),h.push("nc="+f);return"Digest "+h.join(", ")},this.reset=function(){d=null,f="00000000",e=g()};var g=function(){var a=Math.floor(Math.random()*100)+Math.floor(Math.random()*100)+Math.floor(Math.random()*100)+Math.floor(Math.random()*100);return md5(""+a)},h=function(){b&&d&&(c=md5(""+a+":"+d.realm+":"+b),b=null);return c},i=function(a,b){b==null&&(b="GET");var g=c||h();if(d&&g){j();var i=md5(""+b.toUpperCase()+":"+a);return md5(""+g+":"+d.nonce+":"+f+":"+e+":"+d.qop+":"+i)}return""},j=function(){var a=f.length,b=parseInt(f),c=""+b+1;while(c.length<a)c="0"+c;f=c};this.reset()},DigestAuthentication.XMLHttpRequest=function(){var a=new c,e=this,f={},g={},h=0,i,j,k=["status","statusText","responseText","responseXML","upload"],l=["timeout","asBlob","followRedirects","withCredentials"];for(var m=0;m<k.length;m++)(function(){var b=k[m];Object.defineProperty(e,b,{get:function(){return a[b]},enumerable:!0})})();for(var m=0;m<l.length;m++)(function(){var b=l[m];Object.defineProperty(e,b,{get:function(){return a[b]},set:function(c){a[b]=c},enumerable:!0})})();Object.defineProperty(this,"readyState",{get:function(){return h},enumerable:!0});var n=function(a){var c=d(j);if(!!c){var e=new DigestAuthentication.Header;e.setCredantials(c.username,c.password),delete c.password,c.ha1&&e.setHA1(c.ha1),e.parse(a),b[j]=e,DigestAuthentication.registerHA1(e.getHA1(),j);return e.generate(i,f.method)}},o=function(b){var d=n(b);if(!d)h=a.readyState,e.onreadystatechange.call(e);else{a=new c,a.onreadystatechange=function(){a.readyState===4&&(h=a.readyState,e.onreadystatechange.call(e))},a.open(f.method,f.url,f.async),a.setRequestHeader("Authorization",d);for(name in g)a.setRequestHeader(name,g[name]);a.send(_data)}};this.onreadystatechange=function(){},a.onreadystatechange=function(){if(a.readyState===4&&a.status===401){var b=a.getResponseHeader("X-WWW-Authenticate");if(b){o(b);return}}h=a.readyState,e.onreadystatechange.call(e)},this.open=function(b,c,d){f.method=b,f.url=c,f.async=d,j=c.replace(/http:\/\//,"").split("/").shift(),i=c.replace(/http:\/\/[^\/]*/,""),a.open(b,c,d)},this.send=function(c){_data=c;var d=b[j];d?a.setRequestHeader("Authorization",d.generate(i,f.method)):c=null,a.send(c)},this.getResponseHeader=function(b){return a.getRequestHeader(b)},this.getAllResponseHeaders=function(){return a.getAllResponseHeaders()},this.setRequestHeader=function(b,c){g[b]=c,a.setRequestHeader(b,c)},this.abort=function(){a.abort()},this.overrideMimeType=function(b){a.overrideMimeType(b)}}})(),function(){function l(a,b){return a+b&4294967295}function k(a){for(var b=0;b<a.length;b++)a[b]=j(a[b]);return a.join("")}function j(a){var b="",c=0;for(;c<4;c++)b+=i[a>>c*8+4&15]+i[a>>c*8&15];return b}function h(a){var b=[],c;for(c=0;c<64;c+=4)b[c>>2]=a.charCodeAt(c)+(a.charCodeAt(c+1)<<8)+(a.charCodeAt(c+2)<<16)+(a.charCodeAt(c+3)<<24);return b}function g(b){/[\x80-\xFF]/.test(b)&&(b=unescape(encodeURI(b))),txt="";var c=b.length,d=[1732584193,-271733879,-1732584194,271733878],e;for(e=64;e<=b.length;e+=64)a(d,h(b.substring(e-64,e)));b=b.substring(e-64);var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<b.length;e++)f[e>>2]|=b.charCodeAt(e)<<(e%4<<3);f[e>>2]|=128<<(e%4<<3);if(e>55){a(d,f);for(e=0;e<16;e++)f[e]=0}f[14]=c*8,a(d,f);return d}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function b(a,b,c,d,e,f){b=l(l(b,a),l(d,f));return l(b<<e|b>>>32-e,c)}function a(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=l(g,a[0]),a[1]=l(h,a[1]),a[2]=l(i,a[2]),a[3]=l(j,a[3])}var i="0123456789abcdef".split("");md5=function(a){return k(g(a))};if(md5("hello")!="5d41402abc4b2a76b9719d911017c592")function l(a,b){var c=(a&65535)+(b&65535),d=(a>>16)+(b>>16)+(c>>16);return d<<16|c&65535}}(),SB=this.SB||{},SB.CurrentUser=SC.Object.extend({username:"",password:"",rememberMe:!0,url:"/authenticate",authenticateMethod:"HEAD",isLoggedIn:!1,isLoggingIn:!1,didLoggedIn:SC.K,didLoggedOut:SC.K,loginSuccess:SC.K,loginError:SC.K,setCredentials:SC.K,resetCredentials:SC.K,login:function(){if(!this.get("isLoggedIn")){this.set("isLoggingIn",!0);var a=this.get("username"),b=this.get("password");!SC.empty(a)&&!SC.empty(b)&&this.setCredentials(a,b);var c="%@Url".fmt(this.get("authenticateMethod").toLowerCase());SC.Request[c](this.get("url")).json().notify(this,"loginComplete").send()}},logout:function(){!this.get("isLoggedIn")||(this.setProperties({username:"",password:""}),this.resetCredentials(),this.set("isLoggedIn",!1),this.didLoggedOut())},loginComplete:function(a){this.set("isLoggingIn",!1),SC.ok(a)?(this.set("isLoggedIn",!0),this.loginSuccess(a),this.didLoggedIn(),this.setProperties({username:"",password:""})):(this.set("isLoggedIn",!1),this.set("password",""),this.resetCredentials(),this.loginError(a))}}),SB=this.SB||{},SB.PaginatedArray=SC.ArrayProxy.extend({content:[],limit:100,offset:0,total:0,isLoading:!1,didRequireRange:SC.K,reset:function(){this.set("offset",0),this.set("total",0),this.set("content",[]),this._didRequireRange(this.limit,0)},reload:function(){this._didRequireRange(this.limit,this.offset)},_didRequireRange:function(a,b){this.set("isLoading",!0),this.didRequireRange(a,b)},rangeDidLoaded:function(a,b){this.set("total",a),this.set("content",b),this.set("isLoading",!1)},nextPage:function(){this.get("hasNextPage")&&(this.incrementProperty("offset"),this._didRequireRange(this.limit,this.offset))},previousPage:function(){this.get("hasPreviousPage")&&(this.decrementProperty("offset"),this._didRequireRange(this.limit,this.offset))},hasNextPage:function(){return(this.offset+1)*this.limit<this.total}.property("offset","limit","total").cacheable(),hasPreviousPage:function(){return this.offset>0}.property("offset").cacheable()}),SB=this.SB||{},SB.RestDataSource=SC.DataSource.extend({storagePrefix:null,resourceURL:function(a,b,c){var d,e=a.resourceName,f=this.get("storagePrefix");if(!e)throw SC.Error.create("You have to define resourceName on %@ ...".fmt(a));c&&(d=b.idFor(c)),f&&(e="%@/%@".fmt(f,e));if(d)return"/%@/%@".fmt(e,d);return"/%@".fmt(e)},fetch:function(a,b){var c=this.resourceURL(b.get("recordType"),a);SC.Request.getUrl(c).json().notify(this,"fetchDidComplete",a,b).send();return!0},fetchDidComplete:function(a,b,c){if(SC.ok(a)){var d=a.get("body");b.loadRecords(c.get("recordType"),d),b.dataSourceDidFetchQuery(c)}else b.dataSourceDidErrorQuery(c,a)},retrieveRecord:function(a,b,c){var d=this.resourceURL(a.recordTypeFor(b),a,b);SC.Request.getUrl(d).json().notify(this,"retrieveRecordDidComplete",a,b).send();return!0},retrieveRecordDidComplete:function(a,b,c){if(SC.ok(a)){var d=a.get("body");b.dataSourceDidComplete(c,d)}else b.dataSourceDidError(c,a)},createRecord:function(a,b){return this._createOrUpdateRecord(a,b)},updateRecord:function(a,b){return this._createOrUpdateRecord(a,b,!0)},_createOrUpdateRecord:function(a,b,c){var d=this.resourceURL(a.recordTypeFor(b),a,b);SC.Request[c?"putUrl":"postUrl"](d).json().notify(this,"writeRecordDidComplete",a,b).send(a.readDataHash(b));return!0},writeRecordDidComplete:function(a,b,c){if(SC.ok(a)){var d=a.get("body");b.idFor(c)?b.dataSourceDidComplete(c,d):b.dataSourceDidComplete(c,d,d.id)}else b.dataSourceDidError(c,a)},destroyRecord:function(a,b){var c=this.resourceURL(a.recordTypeFor(b),a,b);SC.Request.deleteUrl(c).json().notify(this,"destroyRecordDidComplete",a,b).send();return!0},destroyRecordDidComplete:function(a,b,c){SC.ok(a)?b.dataSourceDidDestroy(c):b.dataSourceDidError(c,a)}}),SB=this.SB||{},SB.ToggleViewSupport=SC.Mixin.create({toggleMethod:"toggle",_isVisibleDidChange:function(){var a=this.$()[this.get("toggleMethod")];a||(a="toggle"),a.call(this.$(),this.get("isVisible"))}.observes("isVisible"),show:function(){this.set("isVisible",!0)},hide:function(){this.set("isVisible",!1)},toggle:function(){this.toggleProperty("isVisible")}}),SB=this.SB||{},SB.PaneView=SC.View.extend(SB.ToggleViewSupport,{templateNamePrefix:null,rootElement:'[role="application"]',classNames:["pane"],classNameBindings:["paneClassName"],templateName:function(){var a=this.get("templateNamePrefix");if(a)return a+"_"+this.get("name");return this.get("name")}.property("templateNamePrefix","name").cacheable(),paneClassName:function(){return this.get("name")+"-pane"}.property("name").cacheable(),append:function(){var a=SB.PaneView.currentPane;a&&a.state==="inDOM"&&a.hide(),this.state==="inDOM"?this.show():this.appendTo(this.get("rootElement")),SB.PaneView.currentPane=this}}),SC.Application.reopen({paneViewClass:SB.PaneView,createPanes:function(a){var b=this.get("paneViewClass");(a||[]).forEach(function(a){this["%@PaneView".fmt(a)]=b.create({name:a.toLowerCase()})},this)}}),SB=this.SB||{},SB.PreviousButton=JUI.Button.extend({label:"Previous",action:"previousPage",isVisibleBinding:"targetObject.hasPreviousPage",disabledBinding:"targetObject.isLoading"}),SB.NextButton=JUI.Button.extend({label:"Next",action:"nextPage",isVisibleBinding:"targetObject.hasNextPage",disabledBinding:"targetObject.isLoading"}),HttpCron=SC.Application.create({store:SC.Store.create({commitRecordsAutomatically:!0}).from(SB.RestDataSource.create({storagePrefix:"api"}))}),HttpCron.Task=SC.Record.extend({primaryKey:"id",name:SC.Record.attr(String,{isRequired:!0}),url:SC.Record.attr(String,{isRequired:!0}),cron:SC.Record.attr(String,{isRequired:!0,defaultValue:"0 22 * * 1-5"}),enabled:SC.Record.attr(Boolean,{isRequired:!0,defaultValue:!0}),created_at:SC.Record.attr(Date),timeout:SC.Record.attr(Number,{defaultValue:60})}),HttpCron.Task.resourceName="tasks",HttpCron.EditableTask=SC.Object.extend({isEditing:!1,isNotEditingBinding:SC.Binding.not("isEditing"),record:null,nested:null,cleanUrl:function(){return this.get("url").replace(/^http:\/\//,"")}.property("url").cacheable(),toggle:function(){this.toggleProperty("isEditing")},logs:function(){HttpCron.ExecutionsView.append(),HttpCron.ExecutionsList.fetch(this)},edit:function(){this._findRecord(this._editRecord)},save:function(){this.toggle(),this.get("store").commitChanges(),HttpCron.store.commitRecords(),this._observeRecord(this.get("record"),SC.Record.READY_CLEAN,this._didSaveRecord)},cancel:function(){this.toggle(),this.get("store").discardChanges()},destroy:function(){this._findRecord(this._destroyRecord)},_recordStatusName:function(a){for(var b in SC.Record)if(a===SC.Record[b])return b},_observeRecord:function(a,b,c){a.addObserver("status",this,function d(){a.get("status")===b&&(a.removeObserver("status",this,d),c.call(this,a))}),a.notifyPropertyChange("status")},_findRecord:function(a){var b=this.get("record");b||(b=HttpCron.store.find(HttpCron.Task,this.get("id")),this.set("record",b)),this._observeRecord(b,SC.Record.READY_CLEAN,a)},_editRecord:function(a){if(this.get("isEditing"))return!1;var b=this.get("store");if(!b){var b=HttpCron.store.chain(),c=b.find(a);this.set("nested",c),this.set("store",b)}else this.get("store").reset();this.toggle()},_destroyRecord:function(a){a.destroy(),this._observeRecord(a,SC.Record.DESTROYED_CLEAN,this._didDestroyRecord)},_didSaveRecord:function(a){},_didDestroyRecord:function(a){HttpCron.TasksList.removeObject(this)}}),HttpCron.NewTask=SC.Object.create({nested:null,isVisible:!1,isInvisibleBinding:SC.Binding.not("isVisible"),toggle:function(){this.toggleProperty("isVisible")},save:function(){this.get("store").commitChanges(),HttpCron.store.commitRecords(),this.toggle()},_didShow:function(){if(this.get("isVisible")){var a=this.get("store");if(!a){var a=HttpCron.store.chain();this.set("store",a)}else this.get("store").reset();this.set("nested",a.createRecord(HttpCron.Task,{}))}else this.set("nested",null)}.observes("isVisible")}),DigestAuthentication.registerInterface(),HttpCron.CurrentUser=SB.CurrentUser.create({url:"/api/authenticate",didLoggedIn:function(){HttpCron.TasksPaneView.append(),HttpCron.TasksList.fetch()},didLoggedOut:function(){HttpCron.LoginView.append()},loginError:function(){HttpCron.LoginView.append()},setCredentials:function(a,b){DigestAuthentication.registerCredentials(a,b)},resetCredentials:function(){DigestAuthentication.reset()}}),SC.$(document).ready(function(){HttpCron.CurrentUser.login()}),HttpCron.TasksList=SB.PaginatedArray.create({isLoading:!0,limit:10,fetch:function(){this.reset()},didRequireRange:function(a,b){this._super(),this.set("content",[]);var c="/api/tasks?limit=%@&offset=%@".fmt(a,b);SC.Request.getUrl(c).json().notify(this,"rangeDidLoaded").send()},rangeDidLoaded:function(a){if(SC.ok(a)){var b=a.get("body"),c=b.records.map(function(a){return HttpCron.EditableTask.create(a)},this);this._super(b.total,c)}else this._super(0,[])}}),HttpCron.ExecutionsList=SB.PaginatedArray.create({fetch:function(a){this.set("task",a),this.reset()},didRequireRange:function(a,b){var c=this.get("task");if(!!c){this._super();var d=c.get("id"),e=c.get("name");this.set("title",e);var f="/api/executions/task/%@?limit=%@&offset=%@".fmt(d,a,b);SC.Request.getUrl(f).json().notify(this,"rangeDidLoaded").send()}},rangeDidLoaded:function(a){if(SC.ok(a)){var b=a.get("body");this._super(b.total,b.records)}else this._super(0,[])}}),HttpCron.UsersList=SB.PaginatedArray.create({}),HttpCron.LoginView=SB.PaneView.create({name:"login",contentBinding:"HttpCron.CurrentUser"}),HttpCron.LoginTextField=SC.TextField.extend({contentBinding:"parentView.content",attributeBindings:["disabled"],disabledBinding:"content.isLoggingIn"}),HttpCron.createPanes(["Tasks"]),HttpCron.TasksCollection=SC.CollectionView.extend({contentBinding:"HttpCron.TasksList",classNameBindings:"isLoading",tagName:"ul",classNames:["tasks-list","list"],itemViewClass:SC.View.extend({doubleClick:function(){this.get("content").edit()},mouseEnter:function(){this.$(".show-task button").show()},mouseLeave:function(){this.$(".show-task button").hide()}})}),HttpCron.NewTaskView=SC.View.extend(SB.ToggleViewSupport,{classNames:["new-task"],contentBinding:"HttpCron.NewTask",isVisibleBinding:"content.isVisible",toggleMethod:"slideToggle"}),HttpCron.ExecutionsView=SB.PaneView.create({name:"executions",titleBinding:"HttpCron.ExecutionsList.title"}),HttpCron.ExecutionsCollection=SC.CollectionView.extend({contentBinding:"HttpCron.ExecutionsList",tagName:"ul",classNames:["executions-list","list"]})